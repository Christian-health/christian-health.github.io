---
layout:     post
title:      "echo框架使用学习总结"
subtitle:   "echo"
data:       ""
author:     ""
header-img: img/echo-back-title.jpg
catalog: true
tags:
    - echo
    - go
---



## 为什么选择echo框架？



## 安装运行

​		（1）使用goland创建一个echodemo的项目的目录

​		（2）执行go mod init echodemo，将会生成go.mod文件

​		（3）创建src目录和main目录，并创建main.go

​		（4）拷贝echo官网的demo到main.go

​		（5）执行go run main.go，在执行过程中会自动下载所依赖的echo包，同时将会更新go.mod和go.sum两个文件 

![echo运行成功](https://github.com/Christian-health/christian-health.github.io/blob/master/img/echo-simple-run.jpg?raw=true)



## 使用echo

#### 1、自定义

echo框架可以自定义如下的内容，有些内容有很长，需要单独的章节来总结。

- 自定义
    - Debug
    - 日志
        - 日志输出 
        - 日志级别
        - 自定义日志
    - 自定义 Server
        - 使用 Echo#StartServer()
        - 启动横幅
        - 自定义监听器
- 禁用 HTTP/2
- 读取超时
- 写入超时
- 验证
- 自定义绑定
- 渲染
- HTTP 错误处理

```go
package main

import (
   "github.com/labstack/gommon/log"
   "io"
   "net/http"
   "os"

   "github.com/labstack/echo/v4"
)

func main() {
   // 创建一个Echo的instance
   e := echo.New()
   /*
     用来关闭启动时候的横幅，也就是在启动的控制台上不要打印出如下内容
     D:\gowork\echo\src\main>go run  main.go

      ____    __
     / __/___/ /  ___
    / _// __/ _ \/ _ \
   /___/\__/_//_/\___/ v4.1.16
   High performance, minimalist Go web framework
   https://echo.labstack.com
   ____________________________________O/_______
                                       O\
   ⇨ http server started on [::]:1323
   */
   e.HideBanner=false

   // 用于关闭HTTP/2协议
   e.DisableHTTP2=true

   //用于设置读取请求的最大时间。

   //用于设置日志输出的位置，默认是 os.Stdout
   e.Logger.SetOutput(io.Writer(os.Stdout))

   //下面两个设置完全禁用日志。
   //e.Logger.SetOutput(ioutil.Discard)
   //e.Logger.SetLevel(log.OFF)

   //设置日志级别
   e.Logger.SetLevel(log.DEBUG)
   //e.Logger.SetLevel(log.INFO)
   //e.Logger.SetLevel(log.WARN)
   //e.Logger.SetLevel(log.ERROR)
   //e.Logger.SetLevel(log.OFF)

   // Routes
   e.GET("/", hello)

   // Start server
   e.Logger.Fatal(e.Start(":1323"))
}

type customerLogger struct {
   Logger echo.Logger
}

// Handler
func hello(c echo.Context) error {
   return c.String(http.StatusOK, "Hello World,customize!")
}	
```

## Context

echo.Context 代表了当前 HTTP 请求的 context（上下文），它含有请求和相应的引用，路径，路径参数，数据，注册的业务处理方法和读取请求和输出响应的API。由于 Context 是一个接口，所以也可以很方便的使用自定义的 API 扩展。
```go
package main

import (
	"net/http"

	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
)

/*
	扩展 Context
	定义一个自定义 context
*/
type CustomContext struct {
	echo.Context
}

func (c *CustomContext) Foo() {
	println("foo function run")
}

func (c *CustomContext) Bar() {
	println("bar function run")
}

func main() {
	// Echo instance
	e := echo.New()

	// Middleware
	/*
		创建一个中间件来扩展默认的 context
		此中间件应在任何其他中间件之前注册
	*/
	e.Use(func(next echo.HandlerFunc) echo.HandlerFunc {
		return func(c echo.Context) error {
			println("middleware customcontext run")
			cc := &CustomContext{c}
			return next(cc)
		}
	})

	e.Use(middleware.Logger())
	e.Use(middleware.Recover())

	// Routes
	e.GET("/", hello)

	//在处理器中使用自定义的context
	e.GET("/content", func(c echo.Context) error {
		cc := c.(*CustomContext)
		//cc.Foo()
		//cc.Bar()
		return cc.String(200, "OK")
	})

	// Start server
	e.Logger.Fatal(e.Start(":1323"))
}

// Handler
func hello(c echo.Context) error {
	return c.String(http.StatusOK, "Hello, World!")
}

```
## Cookies
Cookie 是用户访问网站时浏览器上存储的小型文本文件，由服务器发送而来。每当用户加载网站时，浏览器都会将 cookie 发送回服务器以通知用户之前的活动。 Cookie 作为一个可靠验证凭据，可用来记录状态信息（比如在线商城购物车中的商品）或记录用户的浏览器活动（包括单击特定按钮，登录或记录访问过的页面）。Cookie 还可以存储用户先前输入的密码和表单内容，例如信用卡号或地址。
    Cookie 属性
 |属性 | 可选 |
 | -- | -- |
| Name | No |
| Value	| No |
| Path	| Yes |
| Domain | Yes |
| Expires | Yes|
| Secure | Yes |
| HTTPOnly | Yes |
Echo 使用 golang 自带的 http.Cookie 对象写入／读取从上下文中的 cookie。

```go
package main

import (
	"fmt"
	"net/http"
	"time"

	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
)

func main() {
	// Echo instance
	e := echo.New()

	// Middleware
	e.Use(middleware.Logger())
	e.Use(middleware.Recover())

	// Routes
	e.GET("/", hello)

	// 写入cookie
	e.GET("/writeCookie", writeCookie)
	// 读取cookie
	e.GET("/readCookie", readCookie)
	// 读取所有的cookie
	e.GET("/readAllCookies", readAllCookies)

	// Start server
	e.Logger.Fatal(e.Start(":1323"))
}

// Handler
func hello(c echo.Context) error {
	return c.String(http.StatusOK, "Hello, World!")
}

// 写cookie
func writeCookie(c echo.Context) error {
	cookie := new(http.Cookie)
	cookie.Name = "username"
	cookie.Value = "jon"
	cookie.Expires = time.Now().Add(24 * time.Hour)
	c.SetCookie(cookie)
	return c.String(http.StatusOK, "write a cookie")
}

// 读cookie
func readCookie(c echo.Context) error {
	cookie, err := c.Cookie("username")
	if err != nil {
		return err
	}
	fmt.Println("read cookie Name :", cookie.Name)
	fmt.Println("read cookie Value :", cookie.Value)
	return c.String(http.StatusOK, "read a cookie")
}

// 读取所有的cookie
func readAllCookies(c echo.Context) error {
	for index, cookie := range c.Cookies() {
		fmt.Printf("read all cookie,index is %v Name %s\n", index, cookie.Name)
		fmt.Printf("read all cookie,index is %v Value %s\n", index, cookie.Value)
	}
	return c.String(http.StatusOK, "read all the cookies")
}
/*
[root]$ go run main.go 

   ____    __
  / __/___/ /  ___
 / _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.1.16
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
                                    O\
⇨ http server started on [::]:1323
read all cookie,index is 0 Name username //读所有的cookie
read all cookie,index is 0 Value jon 
{"time":"2020-07-18T21:23:28.246793142+08:00","id":"","remote_ip":"::1","host":"localhost:1323","method":"GET","uri":"/readAllCookies","user_agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36","status":200,"error":"","latency":163405,"latency_human":"163.405µs","bytes_in":0,"bytes_out":20}
read cookie Name : username //读取单个cookie
read cookie Value : jon
{"time":"2020-07-18T21:24:53.078681646+08:00","id":"","remote_ip":"::1","host":"localhost:1323","method":"GET","uri":"/readCookie","user_agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36","status":200,"error":"","latency":40588,"latency_human":"40.588µs","bytes_in":0,"bytes_out":13}
*/
```
## 参考：

- [echo英文官方文档](https://echo.labstack.com/guide )
- [echo中文文档](https://www.bookstack.cn/read/go-echo/README.md)
- [ECHO系列教程](http://blog.studygolang.com/category/echo-%e7%b3%bb%e5%88%97/)
- [tizi365的echo教程](https://www.tizi365.com/archives/28.html)
- [邱权武的echo教程](https://www.yuque.com/qiuquanwu/lz8ker/trglbn)
