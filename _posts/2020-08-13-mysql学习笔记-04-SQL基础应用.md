3. MySQL的连接管理
3.1 mysql 命令 
注意:提前应该将用户授权做好
```mysql> grant all on *.* to root@'10.0.0.%' identified by '123';```
## TCPIP 方式连接：
```mysql -uroot -p -h 10.0.0.51 -P3306 ```
如果指定了-P，同时没有指定-h，也就是如下的样子：
```mysql -uroot -p -h 10.0.0.51 -P3306 ```
那么这个是通过sock的方式进行连接。
## Socket方式连接：  
```mysql -uroot -p -S /tmp/mysql.sock```

如果通过socket方式登录的时候添加了-h参数，那么也就是如下命令，则是通过远程方式连接的。

```mysql -uroot -p -S /tmp/mysql.sock -h 10.0.0.51 -P3306```

这个怎么证明它是远程连接的？可以通过
- [查看一个登陆方式是远程还是本地]()


3.2 客户端工具
    sqlyog

[sqlyog连接]()

- 
  navicat

4. 多实例管理4.1 准备多个目录
  ```mkdir -p /data/330{7,8,9}/data```

4.2 准备配置文件

```cat > /data/3307/my.cnf <<EOF
[mysqld]
basedir=/application/mysql
datadir=/data/3307/data
socket=/data/3307/mysql.sock
log_error=/data/3307/mysql.log
port=3307
server_id=7
log_bin=/data/3307/mysql-bin
EOF

cat > /data/3308/my.cnf <<EOF
[mysqld]
basedir=/application/mysql
datadir=/data/3308/data
socket=/data/3308/mysql.sock
log_error=/data/3308/mysql.log
port=3308
server_id=8
log_bin=/data/3308/mysql-bin
EOF


cat > /data/3309/my.cnf <<EOF
[mysqld]
basedir=/application/mysql
datadir=/data/3309/data
socket=/data/3309/mysql.sock
log_error=/data/3309/mysql.log
port=3309
server_id=9
log_bin=/data/3309/mysql-bin
EOF



```


4.3 初始化三套数据

```shell
mysqld --initialize-insecure  --user=mysql --datadir=/data/3307/data --basedir=/application/mysql

mysqld --initialize-insecure  --user=mysql --datadir=/data/3308/data --basedir=/application/mysql

mysqld --initialize-insecure  --user=mysql --datadir=/data/3309/data --basedir=/application/mysql

```

4.4 systemd管理多实例

```shell
cp mysqld.service mysqld3307.service
cp mysqld.service mysqld3308.service
cp mysqld.service mysqld3309.service

```

`vim mysqld3307.service`
**修改为:**
`ExecStart=/application/mysql/bin/mysqld  --defaults-file=/data/3307/my.cnf`

`vim mysqld3308.service`
**修改为:**
`ExecStart=/application/mysql/bin/mysqld  --defaults-file=/data/3308/my.cnf`

`vim mysqld3309.service`
**修改为:**
`ExecStart=/application/mysql/bin/mysqld  --defaults-file=/data/3309/my.cnf`

修改之后的结果如下：
```shell
[root@db01 system]# grep "ExecStart" mysqld3309.service
ExecStart=/application/mysql/bin/mysqld --defaults-file=/data/3309/my.cnf
[root@db01 system]# grep "ExecStart" mysqld3308.service
ExecStart=/application/mysql/bin/mysqld --defaults-file=/data/3308/my.cnf
[root@db01 system]# grep "ExecStart" mysqld3307.service
ExecStart=/application/mysql/bin/mysqld --defaults-file=/data/3307/my.cnf
[root@db01 system]# 
```

4.5 授权
```chown -R mysql.mysql /data/*```
4.6 启动

```shell
systemctl start mysqld3307.service
systemctl start mysqld3308.service
systemctl start mysqld3309.service
```

4.7 验证多实例

```shell
mysql -S /data/3307/mysql.sock -e "select @@server_id"
mysql -S /data/3308/mysql.sock -e "select @@server_id"
mysql -S /data/3309/mysql.sock -e "select @@server_id"
```
- [启动之后能看到各个mysql的serverId启动失败则看不到]()

4.8 连接到多实例

因为刚搭建的mysql只有本地的root用户

```
mysql -S /data/3307/mysql.sock
```



## 参考

